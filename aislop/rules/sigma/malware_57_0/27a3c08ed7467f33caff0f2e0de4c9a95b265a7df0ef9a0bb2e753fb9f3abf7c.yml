title: Malware_57.0 behavior detection (27a3c08e)
id: 27a3c08ed7467f33caff0f2e0de4c9a95b265a7df0ef9a0bb2e753fb9f3abf7c
status: experimental
description: Auto-generated Sigma rule for Malware_57.0
logsource:
  product: windows
  service: sysmon
detection:
  selection_behavior:
  - EventData: "Found reference to API \"RegCloseKey\" (Indicator: \"RegCloseKey\"\
      ; File: \"27a3c08ed7467f33caff0f2e0de4c9a95b265a7df0ef9a0bb2e753fb9f3abf7c.bin\"\
      )\n Found reference to API \"RegCloseKey\" (Indicator: \"RegCloseKey\"; Source:\
      \ \"00000000-00006572.00000002.234734.F6921000.00000020.mdmp\")"
  - EventData: Contains ability to disable/close registry key (API string)
  - EventData: string-345
  - EventData: "Found reference to API \"CreateFileA\" (Indicator: \"CreateFile\"\
      ; File: \"27a3c08ed7467f33caff0f2e0de4c9a95b265a7df0ef9a0bb2e753fb9f3abf7c.bin\"\
      )\n Found reference to API \"CreateFileA\" (Indicator: \"CreateFile\"; Source:\
      \ \"00000000-00006572.00000002.234734.F6921000.00000020.mdmp\")"
  - EventData: Contains ability to create/open files (API string)
  - EventData: string-315
  - EventData: "Found reference to API \"CreateProcessA\" (Indicator: \"CreateProcess\"\
      ; File: \"27a3c08ed7467f33caff0f2e0de4c9a95b265a7df0ef9a0bb2e753fb9f3abf7c.bin\"\
      )\n Found reference to API \"CreateProcessA\" (Indicator: \"CreateProcess\"\
      ; Source: \"00000000-00006572.00000002.234734.F6921000.00000020.mdmp\")"
  - EventData: Contains ability to create a new process (API string)
  - EventData: string-204
  - EventData: "Found reference to API \"CreateDirectoryA\" (Indicator: \"CreateDirectory\"\
      ; File: \"27a3c08ed7467f33caff0f2e0de4c9a95b265a7df0ef9a0bb2e753fb9f3abf7c.bin\"\
      )\n Found reference to API \"CreateDirectoryA\" (Indicator: \"CreateDirectory\"\
      ; Source: \"00000000-00006572.00000002.234734.F6921000.00000020.mdmp\")"
  - EventData: Contains ability to create directories (API string)
  - EventData: string-423
  - EventData: "\"Software\\Microsoft\\Windows\\CurrentVersion\\App Paths\" in Source:\
      \ 27a3c08ed7467f33caff0f2e0de4c9a95b265a7df0ef9a0bb2e753fb9f3abf7c.bin\n \"\
      Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce\" in Source: 27a3c08ed7467f33caff0f2e0de4c9a95b265a7df0ef9a0bb2e753fb9f3abf7c.bin\n\
      \ \"System\\CurrentControlSet\\Control\\Session Manager\" in Source: 27a3c08ed7467f33caff0f2e0de4c9a95b265a7df0ef9a0bb2e753fb9f3abf7c.bin\n\
      \ \"System\\CurrentControlSet\\Control\\Session Manager\\FileRenameOperations\"\
      \ in Source: 27a3c08ed7467f33caff0f2e0de4c9a95b265a7df0ef9a0bb2e753fb9f3abf7c.bin\n\
      \ \"Software\\Microsoft\\Windows\\CurrentVersion\\App Paths\" in Source: 00000000-00006572.00000002.234734.F6921000.00000020.mdmp"
  - EventData: Contains registry location strings
  - EventData: string-120
  - EventData: '"<Input Sample.exe" with parameter %TEMP%\IXP000.TMP (UID: 00000000-00006572)'
  - EventData: Creates directory on disk
  - EventData: api-318
  - EventData: "\"<Input Sample.exe\" writes to a file \"C:\\Users\\%OSUSER%\\AppData\\\
      Local\\Temp\\IXP000.TMP\\killlagswitch.bat\"\n \"<Input Sample.exe\" writes\
      \ to a file \"C:\\Users\\%OSUSER%\\AppData\\Local\\Temp\\IXP000.TMP\\LagSwitch.bat\"\
      \n \"<Input Sample.exe\" writes to a file \"C:\\Users\\%OSUSER%\\AppData\\Local\\\
      Temp\\IXP000.TMP\\launchquiet.vbs\""
  - EventData: Writes files in a temp directory
  - EventData: api-267
  - EventData: "\"<Input Sample.exe\" loaded module \"%WINDIR%\\System32\\bcryptprimitives.dll\"\
      \ at 2E420000\n \"cmd.exe\" loaded module \"%WINDIR%\\System32\\bcryptprimitives.dll\"\
      \ at 2E420000\n \"mode.com\" loaded module \"%WINDIR%\\System32\\bcryptprimitives.dll\"\
      \ at 2E420000\n \"timeout.exe\" loaded module \"%WINDIR%\\System32\\bcryptprimitives.dll\"\
      \ at 2E420000\n \"choice.exe\" loaded module \"%WINDIR%\\System32\\bcryptprimitives.dll\"\
      \ at 2E420000"
  - EventData: Loads the Bcrypt module DLL
  - EventData: module-9
  - EventData: '"27a3c08ed7467f33caff0f2e0de4c9a95b265a7df0ef9a0bb2e753fb9f3abf7c.bin"
      has high imagebase  "0x100000000"'
  - EventData: PE file has a high image base
  - EventData: static-93
  - EventData: "\"27a3c08ed7467f33caff0f2e0de4c9a95b265a7df0ef9a0bb2e753fb9f3abf7c.bin\"\
      \ file has an entrypoint instructions - \"sub\trsp, 0x28,call\t0x10000ccc4,add\t\
      rsp, 0x28,jmp\t0x10000c6b4,int3\t,int3\t,int3\t,int3\t,int3\t,int3\t,int3\t\
      ,int3\t,int3\t,int3\t,int3\t,int3\t,nop\tword ptr [rax + rax],cmp\trcx, qword\
      \ ptr [rip + 0x2709],jne\t0x10000ca0b,rol\trcx, 0x10,test\tcx, 0xffff,jne\t\
      0x10000ca07,ret\t0,ror\trcx, 0x10,jmp\t0x10000cd80,int3\t,int3\t,int3\t,int3\t\
      ,int3\t,int3\t,int3\t,int3\t,push\trbx,sub\trsp, 0x20,mov\tr11d, dword ptr [r8],mov\t\
      rbx, rdx,mov\tr9, rcx,and\tr11d, 0xfffffff8,\""
  - EventData: PE file entrypoint instructions
  - EventData: static-96
  - EventData: LoadLibraryA@KERNEL32.dll at 31796-431-0000000100005260
  - EventData: Contains ability to dynamically load libraries
  - EventData: stream-108
  - EventData: "Found registry modification API: \"RegCreateKeyExA\" in file \"27a3c08ed7467f33caff0f2e0de4c9a95b265a7df0ef9a0bb2e753fb9f3abf7c.bin\"\
      \n Found registry modification API: \"RegCreateKeyExA\" in \"00000000-00006572.00000002.234734.F6921000.00000020.mdmp\""
  - EventData: Able to create/load registry keys (API string)
  - EventData: string-307
  - EventData: "Found reference to API \"LockResource\" (Indicator: \"LockResource\"\
      ; File: \"27a3c08ed7467f33caff0f2e0de4c9a95b265a7df0ef9a0bb2e753fb9f3abf7c.bin\"\
      )\n Found reference to API \"LoadResource\" (Indicator: \"LoadResource\"; File:\
      \ \"27a3c08ed7467f33caff0f2e0de4c9a95b265a7df0ef9a0bb2e753fb9f3abf7c.bin\")\n\
      \ Found reference to API \"FreeResource\" (Indicator: \"FreeResource\"; File:\
      \ \"27a3c08ed7467f33caff0f2e0de4c9a95b265a7df0ef9a0bb2e753fb9f3abf7c.bin\")\n\
      \ Found reference to API \"FindResourceA\" (Indicator: \"FindResource\"; File:\
      \ \"27a3c08ed7467f33caff0f2e0de4c9a95b265a7df0ef9a0bb2e753fb9f3abf7c.bin\")\n\
      \ Found reference to API \"SizeofResource\" (Indicator: \"SizeofResource\";\
      \ File: \"27a3c08ed7467f33caff0f2e0de4c9a95b265a7df0ef9a0bb2e753fb9f3abf7c.bin\"\
      )\n Found reference to API \"FindResourceA\" (Indicator: \"FindResource\"; Source:\
      \ \"00000000-00006572.00000002.234734.F6921000.00000020.mdmp\")\n Found reference\
      \ to API \"FreeResource\" (Indicator: \"FreeResource\"; Source: \"00000000-00006572.00000002.234734.F6921000.00000020.mdmp\"\
      )\n Found reference to API \"LoadResource\" (Indicator: \"LoadResource\"; Source:\
      \ \"00000000-00006572.00000002.234734.F6921000.00000020.mdmp\")\n Found reference\
      \ to API \"SizeofResource\" (Indicator: \"SizeofResource\"; Source: \"00000000-00006572.00000002.234734.F6921000.00000020.mdmp\"\
      )\n Found reference to API \"LockResource\" (Indicator: \"LockResource\"; Source:\
      \ \"00000000-00006572.00000002.234734.F6921000.00000020.mdmp\")"
  - EventData: Contains ability to find and load resources of specific modules (API
      string)
  - EventData: string-550
  - EventData: "Found reference to API \"GetLastError\" (Indicator: \"GetLastError\"\
      ; File: \"27a3c08ed7467f33caff0f2e0de4c9a95b265a7df0ef9a0bb2e753fb9f3abf7c.bin\"\
      )\n Found reference to API \"GetLastError\" (Indicator: \"GetLastError\"; Source:\
      \ \"00000000-00006572.00000002.234734.F6921000.00000020.mdmp\")"
  - EventData: Contains ability to set/get the last-error code for a calling thread
      (API string)
  - EventData: string-319
  - EventData: "Found reference to API \"ShowWindow\" (Indicator: \"ShowWindow\";\
      \ File: \"27a3c08ed7467f33caff0f2e0de4c9a95b265a7df0ef9a0bb2e753fb9f3abf7c.bin\"\
      )\n Found reference to API \"ShowWindow\" (Indicator: \"ShowWindow\"; Source:\
      \ \"00000000-00006572.00000002.234734.F6921000.00000020.mdmp\")"
  - EventData: Contains ability to show a graphical window (API string)
  - EventData: string-208
  - EventData: '"wextract.pdb"'
  - EventData: Contains PDB pathways
  - EventData: string-7
  - EventData: "Observed system executable string:\"%WINDIR%\\system32\\advapi32.dll\"\
      \ [Source: 00000000-00006572-00000C2B-2578587852]\n Observed system executable\
      \ string:\"%WINDIR%\\system32\\advpack.dll\" [Source: 00000000-00006572-00000C2B-2578682235]\n\
      \ Observed system executable string:\"rundll32.exe %WINDIR%\\system32\\advpack.dll,DelNodeRunDLL32\
      \ \"%TEMP%\\IXP000.TMP\\\"\" [Source: 00000000-00006572-00000BC1-2578803580]"
  - EventData: References Windows file paths for DLLs (possible dropped files)
  - EventData: string-625
  - EventData: "\"<Input Sample.exe\" loaded module \"API-MS-WIN-CORE-SYNCH-L1-2-0\"\
      \ at base 7ffb2e1b0000\n \"<Input Sample.exe\" loaded module \"API-MS-WIN-CORE-FIBERS-L1-1-1\"\
      \ at base 7ffb2e1b0000\n \"<Input Sample.exe\" loaded module \"API-MS-WIN-CORE-LOCALIZATION-L1-2-1\"\
      \ at base 7ffb2e1b0000\n \"<Input Sample.exe\" loaded module \"KERNEL32\" at\
      \ base 7ffb2ec60000\n \"<Input Sample.exe\" loaded module \"%WINDIR%\\TEMP\\\
      VXOLE64.DLL\" at base 7ffb0f180000\n \"<Input Sample.exe\" loaded module \"\
      KERNEL32.DLL\" at base 7ffb2ec60000\n \"<Input Sample.exe\" loaded module \"\
      %WINDIR%\\SYSTEM32\\ADVAPI32.DLL\" at base 7ffb2f650000\n \"<Input Sample.exe\"\
      \ loaded module \"FECLIENT.DLL\" at base 7ffb154e0000\n \"<Input Sample.exe\"\
      \ loaded module \"%WINDIR%\\SYSTEM32\\ADVPACK.DLL\" at base 7ffb12a90000\n \"\
      <Input Sample.exe\" loaded module \"NTDLL.DLL\" at base 7ffb31340000\n \"cmd.exe\"\
      \ loaded module \"KERNEL32\" at base 7ffb2ec60000\n \"cmd.exe\" loaded module\
      \ \"API-MS-WIN-CORE-STRING-L1-1-0\" at base 7ffb2e1b0000\n \"cmd.exe\" loaded\
      \ module \"API-MS-WIN-CORE-DATETIME-L1-1-1\" at base 7ffb2e1b0000\n \"cmd.exe\"\
      \ loaded module \"API-MS-WIN-CORE-LOCALIZATION-OBSOLETE-L1-2-0\" at base 7ffb2e1b0000\n\
      \ \"cmd.exe\" loaded module \"%WINDIR%\\SYSTEM32\\IMM32.DLL\" at base 7ffb2f620000\n\
      \ \"cmd.exe\" loaded module \"API-MS-WIN-CORE-SYNCH-L1-2-0\" at base 7ffb2e1b0000\n\
      \ \"cmd.exe\" loaded module \"API-MS-WIN-CORE-FIBERS-L1-1-1\" at base 7ffb2e1b0000\n\
      \ \"cmd.exe\" loaded module \"API-MS-WIN-CORE-LOCALIZATION-L1-2-1\" at base\
      \ 7ffb2e1b0000\n \"cmd.exe\" loaded module \"%WINDIR%\\TEMP\\VXOLE64.DLL\" at\
      \ base 7ffb0f180000\n \"cmd.exe\" loaded module \"KERNEL32.DLL\" at base 7ffb2ec60000\n\
      \ \"cmd.exe\" loaded module \"NTDLL.DLL\" at base 7ffb31340000"
  - EventData: Loads modules at runtime
  - EventData: api-7
  - EventData: "\"<Input Sample.exe\" called \"LoadLibrary\" with a parameter api-ms-win-core-synch-l1-2-0\
      \ (UID: 00000000-00006572)\n \"<Input Sample.exe\" called \"LoadLibrary\" with\
      \ a parameter api-ms-win-core-fibers-l1-1-1 (UID: 00000000-00006572)\n \"<Input\
      \ Sample.exe\" called \"LoadLibrary\" with a parameter api-ms-win-core-localization-l1-2-1\
      \ (UID: 00000000-00006572)\n \"<Input Sample.exe\" called \"LoadLibrary\" with\
      \ a parameter kernel32 (UID: 00000000-00006572)\n \"<Input Sample.exe\" called\
      \ \"LoadLibrary\" with a parameter %WINDIR%\\system32\\advapi32.dll (UID: 00000000-00006572)\n\
      \ \"<Input Sample.exe\" called \"LoadLibrary\" with a parameter feclient.dll\
      \ (UID: 00000000-00006572)\n \"<Input Sample.exe\" called \"LoadLibrary\" with\
      \ a parameter %WINDIR%\\system32\\advpack.dll (UID: 00000000-00006572)\n \"\
      cmd.exe\" called \"LoadLibrary\" with a parameter api-ms-win-core-synch-l1-2-0\
      \ (UID: 00000000-00004932)\n \"cmd.exe\" called \"LoadLibrary\" with a parameter\
      \ api-ms-win-core-fibers-l1-1-1 (UID: 00000000-00004932)\n \"cmd.exe\" called\
      \ \"LoadLibrary\" with a parameter api-ms-win-core-localization-l1-2-1 (UID:\
      \ 00000000-00004932)\n \"cmd.exe\" called \"LoadLibrary\" with a parameter kernel32\
      \ (UID: 00000000-00004932)"
  - EventData: Calls an API typically used to load libraries
  - EventData: api-175
  - EventData: "\"<Input Sample.exe\" loaded module \"%WINDIR%\\System32\\rpcrt4.dll\"\
      \ at 2F210000\n \"cmd.exe\" loaded module \"%WINDIR%\\System32\\rpcrt4.dll\"\
      \ at 2F210000\n \"mode.com\" loaded module \"%WINDIR%\\System32\\rpcrt4.dll\"\
      \ at 2F210000\n \"timeout.exe\" loaded module \"%WINDIR%\\System32\\rpcrt4.dll\"\
      \ at 2F210000\n \"choice.exe\" loaded module \"%WINDIR%\\System32\\rpcrt4.dll\"\
      \ at 2F210000"
  - EventData: Loads the RPC (Remote Procedure Call) module DLL
  - EventData: module-10
  selection_network:
  - DestinationHostname: 03d.TMP
  - DestinationHostname: 27a3c08ed7467f33caff0f2e0de4c9a95b265a7df0ef9a0bb2e753fb9f3abf7c.bin
  - DestinationHostname: 27a3c08ed7467f33caff0f2e0de4c9a95b265a7df0ef9a0bb2e753fb9f3abf7c.bin.exe
  - DestinationHostname: COMCTL32.dll
  - DestinationHostname: GDI32.dll
  - DestinationHostname: IXP000.TMP
  - DestinationHostname: Kernel32.dll
  - DestinationHostname: LagSwitch.bat
  - DestinationHostname: USER32.dll
  - DestinationHostname: VERSION.dll
  - DestinationHostname: advapi32.dll
  - DestinationHostname: advpack.dll
  - DestinationHostname: api-ms-win-core-synch-l1-2-0.dll
  - DestinationHostname: choice.exe
  - DestinationHostname: cmd.exe
  - DestinationHostname: conhost.exe
  - DestinationHostname: feclient.dll
  - DestinationHostname: kernel32.dll
  - DestinationHostname: mode.com
  - DestinationHostname: msdownld.tmp
  - DestinationHostname: msvcrt.dll
  - DestinationHostname: ntdll.dll
  - DestinationHostname: rundll32.exe
  - DestinationHostname: setupapi.dll
  - DestinationHostname: setupx.dll
  - DestinationHostname: timeout.exe
  - DestinationHostname: wextract.pdb
  - DestinationHostname: wininit.ini
  condition: selection_behavior or selection_network
