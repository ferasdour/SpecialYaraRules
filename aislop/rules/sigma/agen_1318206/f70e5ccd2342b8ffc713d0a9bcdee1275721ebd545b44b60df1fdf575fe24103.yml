title: AGEN.1318206 behavior detection (f70e5ccd)
id: f70e5ccd2342b8ffc713d0a9bcdee1275721ebd545b44b60df1fdf575fe24103
status: experimental
description: Auto-generated Sigma rule for AGEN.1318206
logsource:
  product: windows
  service: sysmon
detection:
  selection_behavior:
  - EventData: "file/memory contains long string with (Indicator: \"CreateFile\";\
      \ File: \"f70e5ccd2342b8ffc713d0a9bcdee1275721ebd545b44b60df1fdf575fe24103.bin\"\
      )\n Found reference to API \"syscall.procCreateFileW\" (Indicator: \"CreateFile\"\
      ; File: \"f70e5ccd2342b8ffc713d0a9bcdee1275721ebd545b44b60df1fdf575fe24103.bin\"\
      )\n Found reference to API \"syscall.procCreateFileMappingW\" (Indicator: \"\
      CreateFile\"; File: \"f70e5ccd2342b8ffc713d0a9bcdee1275721ebd545b44b60df1fdf575fe24103.bin\"\
      )\n Found reference to API \"CreateFileA\" (Indicator: \"CreateFile\"; Source:\
      \ \"00000000-00007664.00000000.221433.0036C000.00000004.mdmp, 00000000-00007664.00000000.221433.00420000.00000004.mdmp,\
      \ 00000000-00007664.00000000.221433.40000000.00000040.mdmp, 00000000-00007664.00000001.221602.40000000.00000040.mdmp\"\
      )\n file/memory contains long string with (Indicator: \"CreateFile\"; Source:\
      \ \"00000000-00007664.00000000.221433.00B71000.00000002.mdmp\")\n Found reference\
      \ to API \"CreateFileMappingA\" (Indicator: \"CreateFile\"; Source: \"00000000-00007664.00000000.221433.40000000.00000040.mdmp,\
      \ 00000000-00007664.00000001.221602.40000000.00000040.mdmp\")\n Found reference\
      \ to API \"syscall.procCreateFileW\" (Indicator: \"CreateFile\"; Source: \"\
      00000000-00007664.00000001.221602.00D56000.00000002.mdmp\")\n Found reference\
      \ to API \"syscall.procCreateFileMappingW\" (Indicator: \"CreateFile\"; Source:\
      \ \"00000000-00007664.00000001.221602.00D56000.00000002.mdmp\")"
  - EventData: Contains ability to create/open files (API string)
  - EventData: string-315
  - EventData: "file/memory contains long string with (Indicator: \"RegCloseKey\"\
      ; File: \"f70e5ccd2342b8ffc713d0a9bcdee1275721ebd545b44b60df1fdf575fe24103.bin\"\
      )\n Found reference to API \"syscall.procRegCloseKey\" (Indicator: \"RegCloseKey\"\
      ; File: \"f70e5ccd2342b8ffc713d0a9bcdee1275721ebd545b44b60df1fdf575fe24103.bin\"\
      )\n Found reference to API \"RegCloseKey\" (Indicator: \"RegCloseKey\"; Source:\
      \ \"00000000-00007664.00000000.221433.0036C000.00000004.mdmp, 00000000-00007664.00000000.221433.00420000.00000004.mdmp,\
      \ 00000000-00007664.00000000.221433.40000000.00000040.mdmp, 00000000-00007664.00000001.221602.40000000.00000040.mdmp\"\
      )\n file/memory contains long string with (Indicator: \"RegCloseKey\"; Source:\
      \ \"00000000-00007664.00000000.221433.00B71000.00000002.mdmp\")\n Found reference\
      \ to API \"syscall.procRegCloseKey\" (Indicator: \"RegCloseKey\"; Source: \"\
      00000000-00007664.00000001.221602.00D56000.00000002.mdmp\")"
  - EventData: Contains ability to disable/close registry key (API string)
  - EventData: string-345
  - EventData: "file/memory contains long string with (Indicator: \"CreateProcess\"\
      ; File: \"f70e5ccd2342b8ffc713d0a9bcdee1275721ebd545b44b60df1fdf575fe24103.bin\"\
      )\n Found reference to API \"syscall.procCreateProcessW\" (Indicator: \"CreateProcess\"\
      ; File: \"f70e5ccd2342b8ffc713d0a9bcdee1275721ebd545b44b60df1fdf575fe24103.bin\"\
      )\n Found reference to API \"syscall.procCreateProcessAsUserW\" (Indicator:\
      \ \"CreateProcess\"; File: \"f70e5ccd2342b8ffc713d0a9bcdee1275721ebd545b44b60df1fdf575fe24103.bin\"\
      )\n Found reference to API \"CreateProcessA\" (Indicator: \"CreateProcess\"\
      ; Source: \"00000000-00007664.00000000.221433.0036C000.00000004.mdmp, 00000000-00007664.00000000.221433.00420000.00000004.mdmp,\
      \ 00000000-00007664.00000000.221433.40000000.00000040.mdmp, 00000000-00007664.00000001.221602.40000000.00000040.mdmp\"\
      )\n file/memory contains long string with (Indicator: \"CreateProcess\"; Source:\
      \ \"00000000-00007664.00000000.221433.00B71000.00000002.mdmp\")\n Found reference\
      \ to API \"syscall.procCreateProcessW\" (Indicator: \"CreateProcess\"; Source:\
      \ \"00000000-00007664.00000001.221602.00D56000.00000002.mdmp\")\n Found reference\
      \ to API \"syscall.procCreateProcessAsUserW\" (Indicator: \"CreateProcess\"\
      ; Source: \"00000000-00007664.00000001.221602.00D56000.00000002.mdmp\")"
  - EventData: Contains ability to create a new process (API string)
  - EventData: string-204
  - EventData: "file/memory contains long string with (Indicator: \"CreateDirectory\"\
      ; File: \"f70e5ccd2342b8ffc713d0a9bcdee1275721ebd545b44b60df1fdf575fe24103.bin\"\
      )\n Found reference to API \"syscall.procCreateDirectoryW\" (Indicator: \"CreateDirectory\"\
      ; File: \"f70e5ccd2342b8ffc713d0a9bcdee1275721ebd545b44b60df1fdf575fe24103.bin\"\
      )\n Found reference to API \"CreateDirectoryA\" (Indicator: \"CreateDirectory\"\
      ; Source: \"00000000-00007664.00000000.221433.0036C000.00000004.mdmp, 00000000-00007664.00000000.221433.00420000.00000004.mdmp,\
      \ 00000000-00007664.00000000.221433.40000000.00000040.mdmp, 00000000-00007664.00000001.221602.40000000.00000040.mdmp\"\
      )\n Found reference to API \"CreateDirectoryACreateDirectoryA\" (Indicator:\
      \ \"CreateDirectory\"; Source: \"00000000-00007664.00000000.221433.00420000.00000004.mdmp\"\
      )\n file/memory contains long string with (Indicator: \"CreateDirectory\"; Source:\
      \ \"00000000-00007664.00000000.221433.00B71000.00000002.mdmp\")\n Found reference\
      \ to API \"syscall.procCreateDirectoryW\" (Indicator: \"CreateDirectory\"; Source:\
      \ \"00000000-00007664.00000001.221602.00D56000.00000002.mdmp\")"
  - EventData: Contains ability to create directories (API string)
  - EventData: string-423
  - EventData: "file/memory contains long string with (Indicator: \"MoveFile\"; File:\
      \ \"f70e5ccd2342b8ffc713d0a9bcdee1275721ebd545b44b60df1fdf575fe24103.bin\")\n\
      \ Found reference to API \"syscall.procMoveFileW\" (Indicator: \"MoveFile\"\
      ; File: \"f70e5ccd2342b8ffc713d0a9bcdee1275721ebd545b44b60df1fdf575fe24103.bin\"\
      )\n file/memory contains long string with (Indicator: \"MoveFile\"; Source:\
      \ \"00000000-00007664.00000000.221433.00B71000.00000002.mdmp\")\n Found reference\
      \ to API \"syscall.procMoveFileW\" (Indicator: \"MoveFile\"; Source: \"00000000-00007664.00000001.221602.00D56000.00000002.mdmp\"\
      )"
  - EventData: Contains ability to move file or directory (API string)
  - EventData: string-322
  - EventData: "file/memory contains long string with (Indicator: \"GetLastError\"\
      ; File: \"f70e5ccd2342b8ffc713d0a9bcdee1275721ebd545b44b60df1fdf575fe24103.bin\"\
      )\n Found reference to API \"syscall.procGetLastError\" (Indicator: \"GetLastError\"\
      ; File: \"f70e5ccd2342b8ffc713d0a9bcdee1275721ebd545b44b60df1fdf575fe24103.bin\"\
      )\n Found reference to API \"GetLastError\" (Indicator: \"GetLastError\"; Source:\
      \ \"00000000-00007664.00000000.221433.0036C000.00000004.mdmp, 00000000-00007664.00000000.221433.00420000.00000004.mdmp,\
      \ 00000000-00007664.00000000.221433.40000000.00000040.mdmp, 00000000-00007664.00000001.221602.40000000.00000040.mdmp\"\
      )\n file/memory contains long string with (Indicator: \"GetLastError\"; Source:\
      \ \"00000000-00007664.00000000.221433.00B71000.00000002.mdmp\")\n Found reference\
      \ to API \"syscall.procGetLastError\" (Indicator: \"GetLastError\"; Source:\
      \ \"00000000-00007664.00000001.221602.00D56000.00000002.mdmp\")"
  - EventData: Contains ability to set/get the last-error code for a calling thread
      (API string)
  - EventData: string-319
  - EventData: "file/memory contains long string with (Indicator: \"DeviceIoControl\"\
      ; File: \"f70e5ccd2342b8ffc713d0a9bcdee1275721ebd545b44b60df1fdf575fe24103.bin\"\
      )\n Found reference to API \"syscall.procDeviceIoControl\" (Indicator: \"DeviceIoControl\"\
      ; File: \"f70e5ccd2342b8ffc713d0a9bcdee1275721ebd545b44b60df1fdf575fe24103.bin\"\
      )\n file/memory contains long string with (Indicator: \"DeviceIoControl\"; Source:\
      \ \"00000000-00007664.00000000.221433.00B71000.00000002.mdmp\")\n Found reference\
      \ to API \"syscall.procDeviceIoControl\" (Indicator: \"DeviceIoControl\"; Source:\
      \ \"00000000-00007664.00000001.221602.00D56000.00000002.mdmp\")"
  - EventData: Contains ability to create/control drivers (API string)
  - EventData: string-220
  - EventData: "file/memory contains long string(Source: \"00000000-00007664.00000000.221433.00B71000.00000002.mdmp\"\
      )\n Found string \"syscall.procGetCommandLineW\" (Source: \"00000000-00007664.00000001.221602.00D56000.00000002.mdmp\"\
      )"
  - EventData: Able to retrieve command line parameters of the running process
  - EventData: string-930
  - EventData: "\"Software\\Policies\\Microsoft\\Internet Explorer\\Main\" in Source:\
      \ 00000000-00007664.00000000.221433.34A00000.00000004.mdmp\n \"Software\\Microsoft\\\
      Windows\\CurrentVersion\\Internet Settings\\ZoneMap\\\" in Source: 00000000-00007664.00000000.221433.34A00000.00000004.mdmp\n\
      \ 00000000-00007664.00000001.221602.34A00000.00000004.mdmp\n \"SOFTWARE\\Microsoft\\\
      Cryptography\\Defaults\\Provider\\Microsoft Enhanced RSA and AES Cryptographic\
      \ Provider\" in Source: 00000000-00007664.00000001.221602.34A00000.00000004.mdmp"
  - EventData: Contains registry location strings
  - EventData: string-120
  - EventData: 'Found reference to API "ShellExecuteExA" (Indicator: "ShellExecute";
      Source: "00000000-00007664.00000000.221433.40000000.00000040.mdmp, 00000000-00007664.00000001.221602.40000000.00000040.mdmp")'
  - EventData: Contains ability to execute an application (API string)
  - EventData: string-240
  - EventData: 'Pattern match: "premium-server@thawte.com"'
  - EventData: Found E-Mail address in binary/memory
  - EventData: string-63
  - EventData: "Found string \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:151.0)\
      \ Gecko/20100101 Firefox/151.0\" (Indicator: \"mozilla/5.0 (\"; Source: \"00000000-00007664.00000000.221433.40000000.00000040.mdmp,\
      \ 00000000-00007664.00000001.221602.40000000.00000040.mdmp\")\n Found string\
      \ \"User-Agent: %s\" (Indicator: \"user-agent: \"; Source: \"00000000-00007664.00000000.221433.40000000.00000040.mdmp,\
      \ 00000000-00007664.00000001.221602.40000000.00000040.mdmp\")\n Found string\
      \ \"User-Agent: Mozilla/5.0\" (Indicator: \"user-agent: \"; Source: \"00000000-00007664.00000001.221602.34A00000.00000004.mdmp,\
      \ 00000000-00007664.00000001.221602.E35FA000.00000004.mdmp\")"
  - EventData: Found user-agent related strings
  - EventData: string-127
  - EventData: "\"<Input Sample.exe\" loaded module \"%WINDIR%\\System32\\bcryptprimitives.dll\"\
      \ at 18500000\n \"<Input Sample.exe\" loaded module \"%WINDIR%\\System32\\bcrypt.dll\"\
      \ at 17FB0000"
  - EventData: Loads the Bcrypt module DLL
  - EventData: module-9
  - EventData: 'Found reference to API "GetWindowThreadProcessId" (Indicator: "GetWindowThreadProcessId";
      Source: "00000000-00007664.00000000.221433.40000000.00000040.mdmp, 00000000-00007664.00000001.221602.40000000.00000040.mdmp")'
  - EventData: Contains ability to show a graphical window (API string)
  - EventData: string-208
  - EventData: "\"<Input Sample.exe\" (Path: \"HKCU\\SOFTWARE\\POLICIES\\MICROSOFT\\\
      SYSTEMCERTIFICATES\\CA\"; Key: \"\")\n \"<Input Sample.exe\" (Path: \"HKCU\\\
      SOFTWARE\\POLICIES\\MICROSOFT\\SYSTEMCERTIFICATES\\CA\\CERTIFICATES\"; Key:\
      \ \"\")\n \"<Input Sample.exe\" (Path: \"HKCU\\SOFTWARE\\POLICIES\\MICROSOFT\\\
      SYSTEMCERTIFICATES\\CA\\CRLS\"; Key: \"\")\n \"<Input Sample.exe\" (Path: \"\
      HKCU\\SOFTWARE\\POLICIES\\MICROSOFT\\SYSTEMCERTIFICATES\\CA\\CTLS\"; Key: \"\
      \")\n \"<Input Sample.exe\" (Path: \"HKLM\\SOFTWARE\\POLICIES\\MICROSOFT\\SYSTEMCERTIFICATES\\\
      CA\"; Key: \"\")\n \"<Input Sample.exe\" (Path: \"HKLM\\SOFTWARE\\POLICIES\\\
      MICROSOFT\\SYSTEMCERTIFICATES\\CA\\CERTIFICATES\"; Key: \"\")\n \"<Input Sample.exe\"\
      \ (Path: \"HKLM\\SOFTWARE\\POLICIES\\MICROSOFT\\SYSTEMCERTIFICATES\\CA\\CRLS\"\
      ; Key: \"\")\n \"<Input Sample.exe\" (Path: \"HKLM\\SOFTWARE\\POLICIES\\MICROSOFT\\\
      SYSTEMCERTIFICATES\\CA\\CTLS\"; Key: \"\")\n \"<Input Sample.exe\" (Path: \"\
      HKCU\\SOFTWARE\\POLICIES\\MICROSOFT\\SYSTEMCERTIFICATES\\DISALLOWED\"; Key:\
      \ \"\")\n \"<Input Sample.exe\" (Path: \"HKCU\\SOFTWARE\\POLICIES\\MICROSOFT\\\
      SYSTEMCERTIFICATES\\DISALLOWED\\CERTIFICATES\"; Key: \"\")\n \"<Input Sample.exe\"\
      \ (Path: \"HKCU\\SOFTWARE\\POLICIES\\MICROSOFT\\SYSTEMCERTIFICATES\\DISALLOWED\\\
      CRLS\"; Key: \"\")\n \"<Input Sample.exe\" (Path: \"HKCU\\SOFTWARE\\POLICIES\\\
      MICROSOFT\\SYSTEMCERTIFICATES\\DISALLOWED\\CTLS\"; Key: \"\")\n \"<Input Sample.exe\"\
      \ (Path: \"HKLM\\SOFTWARE\\POLICIES\\MICROSOFT\\SYSTEMCERTIFICATES\\DISALLOWED\"\
      ; Key: \"\")\n \"<Input Sample.exe\" (Path: \"HKLM\\SOFTWARE\\POLICIES\\MICROSOFT\\\
      SYSTEMCERTIFICATES\\DISALLOWED\\CERTIFICATES\"; Key: \"\")\n \"<Input Sample.exe\"\
      \ (Path: \"HKLM\\SOFTWARE\\POLICIES\\MICROSOFT\\SYSTEMCERTIFICATES\\DISALLOWED\\\
      CRLS\"; Key: \"\")\n \"<Input Sample.exe\" (Path: \"HKLM\\SOFTWARE\\POLICIES\\\
      MICROSOFT\\SYSTEMCERTIFICATES\\DISALLOWED\\CTLS\"; Key: \"\")\n \"<Input Sample.exe\"\
      \ (Path: \"HKLM\\SOFTWARE\\POLICIES\\MICROSOFT\\SYSTEMCERTIFICATES\\ROOT\";\
      \ Key: \"\")\n \"<Input Sample.exe\" (Path: \"HKLM\\SOFTWARE\\POLICIES\\MICROSOFT\\\
      SYSTEMCERTIFICATES\\ROOT\\CERTIFICATES\"; Key: \"\")\n \"<Input Sample.exe\"\
      \ (Path: \"HKLM\\SOFTWARE\\POLICIES\\MICROSOFT\\SYSTEMCERTIFICATES\\ROOT\\CRLS\"\
      ; Key: \"\")\n \"<Input Sample.exe\" (Path: \"HKLM\\SOFTWARE\\POLICIES\\MICROSOFT\\\
      SYSTEMCERTIFICATES\\ROOT\\CTLS\"; Key: \"\")\n \"<Input Sample.exe\" (Path:\
      \ \"HKCU\\SOFTWARE\\POLICIES\\MICROSOFT\\SYSTEMCERTIFICATES\\TRUSTEDPEOPLE\"\
      ; Key: \"\")\n \"<Input Sample.exe\" (Path: \"HKCU\\SOFTWARE\\POLICIES\\MICROSOFT\\\
      SYSTEMCERTIFICATES\\TRUSTEDPEOPLE\\CERTIFICATES\"; Key: \"\")\n \"<Input Sample.exe\"\
      \ (Path: \"HKCU\\SOFTWARE\\POLICIES\\MICROSOFT\\SYSTEMCERTIFICATES\\TRUSTEDPEOPLE\\\
      CRLS\"; Key: \"\")\n \"<Input Sample.exe\" (Path: \"HKCU\\SOFTWARE\\POLICIES\\\
      MICROSOFT\\SYSTEMCERTIFICATES\\TRUSTEDPEOPLE\\CTLS\"; Key: \"\")\n \"<Input\
      \ Sample.exe\" (Path: \"HKLM\\SOFTWARE\\POLICIES\\MICROSOFT\\SYSTEMCERTIFICATES\\\
      TRUSTEDPEOPLE\"; Key: \"\")"
  - EventData: Accesses Software Policy Settings
  - EventData: registry-18
  - EventData: 'Found registry modification API: "RegCreateKeyExA" in "00000000-00007664.00000000.221433.40000000.00000040.mdmp,
      00000000-00007664.00000001.221602.40000000.00000040.mdmp"'
  - EventData: Able to create/load registry keys (API string)
  - EventData: string-307
  - EventData: "\"f70e5ccd2342b8ffc713d0a9bcdee1275721ebd545b44b60df1fdf575fe24103.bin\"\
      \ file has an entrypoint instructions - \"jmp\t0x460c40,int3\t,int3\t,int3\t\
      ,int3\t,int3\t,int3\t,int3\t,int3\t,int3\t,int3\t,int3\t,int3\t,int3\t,int3\t\
      ,int3\t,int3\t,int3\t,int3\t,int3\t,int3\t,int3\t,int3\t,int3\t,int3\t,int3\t\
      ,int3\t,int3\t,pushfq\t,sub\trsp, 0x70,mov\tqword ptr [rsp + 0x50], rdi,mov\t\
      qword ptr [rsp + 0x48], rsi,mov\tqword ptr [rsp + 0x40], rbp,mov\tqword ptr\
      \ [rsp + 0x38], rbx,mov\tqword ptr [rsp + 0x30], r12,mov\tqword ptr [rsp + 0x28],\
      \ r13,mov\tqword ptr [rsp + 0x20], r14,mov\tqword ptr [rsp + 0x58], r15,mov\t\
      r15, rax,mov\trdx, qword ptr gs:[0x28],cmp\trdx, 0,jne\t0x46432b,\""
  - EventData: PE file entrypoint instructions
  - EventData: static-96
  - EventData: '"<Input Sample.exe" loaded module "%WINDIR%\System32\rpcrt4.dll" at
      1B830000'
  - EventData: Loads the RPC (Remote Procedure Call) module DLL
  - EventData: module-10
  - EventData: "\"<Input Sample.exe\" (Path: \"HKLM\\SYSTEM\\CONTROLSET001\\CONTROL\\\
      NLS\\CUSTOMLOCALE\"; Key: \"EN-US\")\n \"<Input Sample.exe\" (Path: \"HKLM\\\
      SYSTEM\\CONTROLSET001\\CONTROL\\NLS\\EXTENDEDLOCALE\"; Key: \"EN-US\")"
  - EventData: Reads information about supported languages
  - EventData: registry-25
  - EventData: '"f70e5ccd2342b8ffc713d0a9bcdee1275721ebd545b44b60df1fdf575fe24103.bin"
      was detected as "Go"  and name: "Compiler"'
  - EventData: Matched Compiler/Packer signature (DIE)
  - EventData: static-157
  selection_network:
  - DestinationHostname: 32.dll
  - DestinationHostname: f70e5ccd2342b8ffc713d0a9bcdee1275721ebd545b44b60df1fdf575fe24103.bin
  - DestinationHostname: f70e5ccd2342b8ffc713d0a9bcdee1275721ebd545b44b60df1fdf575fe24103.bin.exe
  - DestinationHostname: testmycdn.azureedge.net
  - DestinationIp: 151.247.22.212
  condition: selection_behavior or selection_network
