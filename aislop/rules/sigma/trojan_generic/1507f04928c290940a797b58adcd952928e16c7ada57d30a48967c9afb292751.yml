title: Trojan.Generic behavior detection (1507f049)
id: 1507f04928c290940a797b58adcd952928e16c7ada57d30a48967c9afb292751
status: experimental
description: Auto-generated Sigma rule for Trojan.Generic
logsource:
  product: windows
  service: sysmon
detection:
  selection_behavior:
  - EventData: "Found reference to API \"RegCloseKey\" (Indicator: \"RegCloseKey\"\
      ; File: \"1507f04928c290940a797b58adcd952928e16c7ada57d30a48967c9afb292751.bin\"\
      )\n Found reference to API \"RegCloseKey\" (Indicator: \"RegCloseKey\"; Source:\
      \ \"00000000-00007960.00000003.204902.00A15000.00000004.mdmp\")"
  - EventData: Contains ability to disable/close registry key (API string)
  - EventData: string-345
  - EventData: "Found reference to API \"CreateFileA\" (Indicator: \"CreateFile\"\
      ; File: \"1507f04928c290940a797b58adcd952928e16c7ada57d30a48967c9afb292751.bin\"\
      )\n Found reference to API \"CreateFileMappingA\" (Indicator: \"CreateFile\"\
      ; File: \"1507f04928c290940a797b58adcd952928e16c7ada57d30a48967c9afb292751.bin\"\
      )\n Found reference to API \"CreateFileW\" (Indicator: \"CreateFile\"; File:\
      \ \"1507f04928c290940a797b58adcd952928e16c7ada57d30a48967c9afb292751.bin\")\n\
      \ file/memory contains long string with (Indicator: \"CreateFile\"; File: \"\
      1507f04928c290940a797b58adcd952928e16c7ada57d30a48967c9afb292751.bin\")\n Found\
      \ reference to API \"CreateFileMappingA\" (Indicator: \"CreateFile\"; Source:\
      \ \"00000000-00007960.00000000.195556.004A5000.00000040.mdmp\")\n Found reference\
      \ to API \"CreateFileA\" (Indicator: \"CreateFile\"; Source: \"00000000-00007960.00000003.204902.00A15000.00000004.mdmp\"\
      )"
  - EventData: Contains ability to create/open files (API string)
  - EventData: string-315
  - EventData: "Found reference to API \"CreateProcessA\" (Indicator: \"CreateProcess\"\
      ; File: \"1507f04928c290940a797b58adcd952928e16c7ada57d30a48967c9afb292751.bin\"\
      )\n file/memory contains long string with (Indicator: \"CreateProcess\"; File:\
      \ \"1507f04928c290940a797b58adcd952928e16c7ada57d30a48967c9afb292751.bin\")\n\
      \ Found reference to API \"CreateProcessA\" (Indicator: \"CreateProcess\"; Source:\
      \ \"00000000-00007960.00000003.204902.00A15000.00000004.mdmp\")"
  - EventData: Contains ability to create a new process (API string)
  - EventData: string-204
  - EventData: "Found reference to API \"WinExec\" (Indicator: \"WinExec\"; File:\
      \ \"1507f04928c290940a797b58adcd952928e16c7ada57d30a48967c9afb292751.bin\")\n\
      \ Found reference to API \"ShellExecuteA\" (Indicator: \"ShellExecute\"; File:\
      \ \"1507f04928c290940a797b58adcd952928e16c7ada57d30a48967c9afb292751.bin\")\n\
      \ file/memory contains long string with (Indicator: \"WinExec\"; File: \"1507f04928c290940a797b58adcd952928e16c7ada57d30a48967c9afb292751.bin\"\
      )\n Found reference to API \"WinExec\" (Indicator: \"WinExec\"; Source: \"00000000-00007960.00000003.204902.00A15000.00000004.mdmp\"\
      )\n Found reference to API \"ShellExecuteA\" (Indicator: \"ShellExecute\"; Source:\
      \ \"00000000-00007960.00000003.204902.00A15000.00000004.mdmp\")"
  - EventData: Contains ability to execute an application (API string)
  - EventData: string-240
  - EventData: details too long to display
  - EventData: Contains ability to execute Windows APIs
  - EventData: string-101
  - EventData: "Found reference to API \"GrayStringA\" (Indicator: \"GrayStringA\"\
      ; File: \"1507f04928c290940a797b58adcd952928e16c7ada57d30a48967c9afb292751.bin\"\
      )\n file/memory contains long string with (Indicator: \"GrayStringA\"; File:\
      \ \"1507f04928c290940a797b58adcd952928e16c7ada57d30a48967c9afb292751.bin\")\n\
      \ Found reference to API \"GrayStringA\" (Indicator: \"GrayStringA\"; Source:\
      \ \"00000000-00007960.00000003.204902.00A15000.00000004.mdmp\")"
  - EventData: Able to use GrayString API for text rendering
  - EventData: string-900
  - EventData: "Found registry modification API: \"RegCreateKeyExA\" in file \"1507f04928c290940a797b58adcd952928e16c7ada57d30a48967c9afb292751.bin\"\
      \n Found registry modification API: \"ZwCreateKey\" in file \"1507f04928c290940a797b58adcd952928e16c7ada57d30a48967c9afb292751.bin\"\
      \n Found registry modification API: \"RegCreateKeyExA\" in \"00000000-00007960.00000003.204902.00A15000.00000004.mdmp\""
  - EventData: Able to create/load registry keys (API string)
  - EventData: string-307
  - EventData: "Found reference to API \"ResumeThread\" (Indicator: \"ResumeThread\"\
      ; File: \"1507f04928c290940a797b58adcd952928e16c7ada57d30a48967c9afb292751.bin\"\
      )\n Found reference to API \"CreateThread\" (Indicator: \"CreateThread\"; File:\
      \ \"1507f04928c290940a797b58adcd952928e16c7ada57d30a48967c9afb292751.bin\")\n\
      \ Found reference to API \"CreateThreadpoolTimer\" (Indicator: \"CreateThread\"\
      ; File: \"1507f04928c290940a797b58adcd952928e16c7ada57d30a48967c9afb292751.bin\"\
      )\n Found reference to API \"CreateThreadpoolWait\" (Indicator: \"CreateThread\"\
      ; File: \"1507f04928c290940a797b58adcd952928e16c7ada57d30a48967c9afb292751.bin\"\
      )\n Found reference to API \"CreateThreadpoolWork\" (Indicator: \"CreateThread\"\
      ; File: \"1507f04928c290940a797b58adcd952928e16c7ada57d30a48967c9afb292751.bin\"\
      )\n file/memory contains long string with (Indicator: \"ResumeThread\"; File:\
      \ \"1507f04928c290940a797b58adcd952928e16c7ada57d30a48967c9afb292751.bin\")\n\
      \ file/memory contains long string with (Indicator: \"CreateThread\"; File:\
      \ \"1507f04928c290940a797b58adcd952928e16c7ada57d30a48967c9afb292751.bin\")\n\
      \ Found reference to API \"CreateThread\" (Indicator: \"CreateThread\"; Source:\
      \ \"00000000-00007960.00000000.195556.004A5000.00000040.mdmp, 00000000-00007960.00000003.204902.00A15000.00000004.mdmp\"\
      )\n Found reference to API \"ResumeThread\" (Indicator: \"ResumeThread\"; Source:\
      \ \"00000000-00007960.00000000.195556.004A5000.00000040.mdmp, 00000000-00007960.00000003.204902.00A15000.00000004.mdmp\"\
      )\n Found reference to API \"CreateThreadpoolTimer\" (Indicator: \"CreateThread\"\
      ; Source: \"00000000-00007960.00000002.199396.1000C000.00000002.mdmp\")\n Found\
      \ reference to API \"CreateThreadpoolWait\" (Indicator: \"CreateThread\"; Source:\
      \ \"00000000-00007960.00000002.199396.1000C000.00000002.mdmp\")"
  - EventData: Contains ability to retrieve/modify process thread (API string)
  - EventData: string-161
  - EventData: "Found reference to API \"CreateDirectoryA\" (Indicator: \"CreateDirectory\"\
      ; File: \"1507f04928c290940a797b58adcd952928e16c7ada57d30a48967c9afb292751.bin\"\
      )\n Found reference to API \"CreateDirectoryA\" (Indicator: \"CreateDirectory\"\
      ; Source: \"00000000-00007960.00000000.195556.004A5000.00000040.mdmp\")"
  - EventData: Contains ability to create directories (API string)
  - EventData: string-423
  - EventData: "Found reference to API \"GetLastError\" (Indicator: \"GetLastError\"\
      ; File: \"1507f04928c290940a797b58adcd952928e16c7ada57d30a48967c9afb292751.bin\"\
      )\n Found reference to API \"SetLastError\" (Indicator: \"SetLastError\"; File:\
      \ \"1507f04928c290940a797b58adcd952928e16c7ada57d30a48967c9afb292751.bin\")\n\
      \ file/memory contains long string with (Indicator: \"SetLastError\"; File:\
      \ \"1507f04928c290940a797b58adcd952928e16c7ada57d30a48967c9afb292751.bin\")\n\
      \ file/memory contains long string with (Indicator: \"GetLastError\"; File:\
      \ \"1507f04928c290940a797b58adcd952928e16c7ada57d30a48967c9afb292751.bin\")\n\
      \ Found reference to API \"GetLastError\" (Indicator: \"GetLastError\"; Source:\
      \ \"00000000-00007960.00000000.195556.004A5000.00000040.mdmp, 00000000-00007960.00000003.204902.00A15000.00000004.mdmp\"\
      )\n Found reference to API \"SetLastError\" (Indicator: \"SetLastError\"; Source:\
      \ \"00000000-00007960.00000003.204902.00A15000.00000004.mdmp\")"
  - EventData: Contains ability to set/get the last-error code for a calling thread
      (API string)
  - EventData: string-319
  - EventData: "Found reference to API \"OpenProcess\" (Indicator: \"OpenProcess\"\
      ; File: \"1507f04928c290940a797b58adcd952928e16c7ada57d30a48967c9afb292751.bin\"\
      )\n Found reference to API \"GetProcessHeap\" (Indicator: \"GetProcessHeap\"\
      ; File: \"1507f04928c290940a797b58adcd952928e16c7ada57d30a48967c9afb292751.bin\"\
      )\n Found reference to API \"ZwOpenProcess\" (Indicator: \"OpenProcess\"; File:\
      \ \"1507f04928c290940a797b58adcd952928e16c7ada57d30a48967c9afb292751.bin\")\n\
      \ file/memory contains long string with (Indicator: \"OpenProcess\"; File: \"\
      1507f04928c290940a797b58adcd952928e16c7ada57d30a48967c9afb292751.bin\")\n file/memory\
      \ contains long string with (Indicator: \"GetProcessHeap\"; File: \"1507f04928c290940a797b58adcd952928e16c7ada57d30a48967c9afb292751.bin\"\
      )\n Found reference to API \"OpenProcess\" (Indicator: \"OpenProcess\"; Source:\
      \ \"00000000-00007960.00000000.195556.004A5000.00000040.mdmp, 00000000-00007960.00000003.204902.00A15000.00000004.mdmp\"\
      )\n Found reference to API \"ZwOpenProcess\" (Indicator: \"OpenProcess\"; Source:\
      \ \"00000000-00007960.00000000.195556.004A5000.00000040.mdmp\")\n Found reference\
      \ to API \"GetProcessHeap\" (Indicator: \"GetProcessHeap\"; Source: \"00000000-00007960.00000000.195556.004A5000.00000040.mdmp,\
      \ 00000000-00007960.00000003.204902.00A15000.00000004.mdmp\")"
  - EventData: Contains ability to retrieve/open a process (API string)
  - EventData: string-272
  - EventData: "Found reference to API \"LockResource\" (Indicator: \"LockResource\"\
      ; File: \"1507f04928c290940a797b58adcd952928e16c7ada57d30a48967c9afb292751.bin\"\
      )\n Found reference to API \"FindResourceA\" (Indicator: \"FindResource\"; File:\
      \ \"1507f04928c290940a797b58adcd952928e16c7ada57d30a48967c9afb292751.bin\")\n\
      \ Found reference to API \"LoadResource\" (Indicator: \"LoadResource\"; File:\
      \ \"1507f04928c290940a797b58adcd952928e16c7ada57d30a48967c9afb292751.bin\")\n\
      \ file/memory contains long string with (Indicator: \"FindResource\"; File:\
      \ \"1507f04928c290940a797b58adcd952928e16c7ada57d30a48967c9afb292751.bin\")\n\
      \ file/memory contains long string with (Indicator: \"LoadResource\"; File:\
      \ \"1507f04928c290940a797b58adcd952928e16c7ada57d30a48967c9afb292751.bin\")\n\
      \ file/memory contains long string with (Indicator: \"LockResource\"; File:\
      \ \"1507f04928c290940a797b58adcd952928e16c7ada57d30a48967c9afb292751.bin\")\n\
      \ Found reference to API \"FindResourceA\" (Indicator: \"FindResource\"; Source:\
      \ \"00000000-00007960.00000003.204902.00A15000.00000004.mdmp\")\n Found reference\
      \ to API \"LoadResource\" (Indicator: \"LoadResource\"; Source: \"00000000-00007960.00000003.204902.00A15000.00000004.mdmp\"\
      )\n Found reference to API \"LockResource\" (Indicator: \"LockResource\"; Source:\
      \ \"00000000-00007960.00000003.204902.00A15000.00000004.mdmp\")"
  - EventData: Contains ability to find and load resources of specific modules (API
      string)
  - EventData: string-550
  - EventData: "Pattern match: \"support@safengine.com\"\n Pattern match: \"shielden_user@safengine.com\""
  - EventData: Found E-Mail address in binary/memory
  - EventData: string-63
  - EventData: "Found reference to API \"GetCommandLineA\" (Indicator: \"GetCommandLine\"\
      ; File: \"1507f04928c290940a797b58adcd952928e16c7ada57d30a48967c9afb292751.bin\"\
      )\n Found reference to API \"GetCommandLineW\" (Indicator: \"GetCommandLine\"\
      ; File: \"1507f04928c290940a797b58adcd952928e16c7ada57d30a48967c9afb292751.bin\"\
      )\n file/memory contains long string with (Indicator: \"GetCommandLine\"; File:\
      \ \"1507f04928c290940a797b58adcd952928e16c7ada57d30a48967c9afb292751.bin\")\n\
      \ Found reference to API \"GetCommandLineA\" (Indicator: \"GetCommandLine\"\
      ; Source: \"00000000-00007960.00000003.204902.00A15000.00000004.mdmp\")"
  - EventData: Contains ability to retrieve the command-line string for the current
      process (API string)
  - EventData: string-206
  - EventData: "\"System\\CurrentControlSet\\services\\\" in Source: 1507f04928c290940a797b58adcd952928e16c7ada57d30a48967c9afb292751.bin\n\
      \ \"Software\\\" in Source: 1507f04928c290940a797b58adcd952928e16c7ada57d30a48967c9afb292751.bin"
  - EventData: Contains registry location strings
  - EventData: string-120
  - EventData: "Found reference to API \"DeviceIoControl\" (Indicator: \"DeviceIoControl\"\
      ; File: \"1507f04928c290940a797b58adcd952928e16c7ada57d30a48967c9afb292751.bin\"\
      )\n Found reference to API \"IoCreateDevice\" (Indicator: \"IoCreateDevice\"\
      ; File: \"1507f04928c290940a797b58adcd952928e16c7ada57d30a48967c9afb292751.bin\"\
      )\n Found reference to API \"IoBuildDeviceIoControlRequest\" (Indicator: \"\
      DeviceIoControl\"; File: \"1507f04928c290940a797b58adcd952928e16c7ada57d30a48967c9afb292751.bin\"\
      )\n Found reference to API \"IoBuildDeviceIoControlRequest\" (Indicator: \"\
      IoBuildDeviceIoControlRequest\"; File: \"1507f04928c290940a797b58adcd952928e16c7ada57d30a48967c9afb292751.bin\"\
      )\n Found reference to API \"IofCallDriver\" (Indicator: \"IofCallDriver\";\
      \ File: \"1507f04928c290940a797b58adcd952928e16c7ada57d30a48967c9afb292751.bin\"\
      )\n file/memory contains long string with (Indicator: \"DeviceIoControl\"; File:\
      \ \"1507f04928c290940a797b58adcd952928e16c7ada57d30a48967c9afb292751.bin\")\n\
      \ Found reference to API \"DeviceIoControl\" (Indicator: \"DeviceIoControl\"\
      ; Source: \"00000000-00007960.00000000.195556.004A5000.00000040.mdmp, 00000000-00007960.00000003.204902.00A15000.00000004.mdmp\"\
      )"
  - EventData: Contains ability to create/control drivers (API string)
  - EventData: string-220
  - EventData: "Found reference to API \"ShowWindow\" (Indicator: \"ShowWindow\";\
      \ File: \"1507f04928c290940a797b58adcd952928e16c7ada57d30a48967c9afb292751.bin\"\
      )\n Found reference to API \"GetWindowThreadProcessId\" (Indicator: \"GetWindowThreadProcessId\"\
      ; File: \"1507f04928c290940a797b58adcd952928e16c7ada57d30a48967c9afb292751.bin\"\
      )\n file/memory contains long string with (Indicator: \"ShowWindow\"; File:\
      \ \"1507f04928c290940a797b58adcd952928e16c7ada57d30a48967c9afb292751.bin\")\n\
      \ file/memory contains long string with (Indicator: \"GetWindowThreadProcessId\"\
      ; File: \"1507f04928c290940a797b58adcd952928e16c7ada57d30a48967c9afb292751.bin\"\
      )\n Found reference to API \"ShowWindow\" (Indicator: \"ShowWindow\"; Source:\
      \ \"00000000-00007960.00000003.204902.00A15000.00000004.mdmp\")\n Found reference\
      \ to API \"GetWindowThreadProcessId\" (Indicator: \"GetWindowThreadProcessId\"\
      ; Source: \"00000000-00007960.00000003.204902.00A15000.00000004.mdmp\")"
  - EventData: Contains ability to show a graphical window (API string)
  - EventData: string-208
  - EventData: "Found string \"MoveFileA\" (Indicator: \"MoveFileA\"; File: \"1507f04928c290940a797b58adcd952928e16c7ada57d30a48967c9afb292751.bin\"\
      )\n Found string \"MoveFileExA\" (Indicator: \"MoveFileExA\"; File: \"1507f04928c290940a797b58adcd952928e16c7ada57d30a48967c9afb292751.bin\"\
      )\n Found string \"MoveFileA\" (Indicator: \"MoveFileA\"; Source: \"00000000-00007960.00000000.195556.004A5000.00000040.mdmp\"\
      )\n Found string \"MoveFileExA\" (Indicator: \"MoveFileExA\"; Source: \"00000000-00007960.00000000.195556.004A5000.00000040.mdmp\"\
      )"
  - EventData: Able to rename or move file/directory (API string)
  - EventData: string-884
  - EventData: 'Found string "GetCommandLineA" (Source: "00000000-00007960.00000003.204902.00A15000.00000004.mdmp")'
  - EventData: Able to retrieve command line parameters of the running process
  - EventData: string-930
  - EventData: "Found reference to API \"MoveFileA\" (Indicator: \"MoveFile\"; File:\
      \ \"1507f04928c290940a797b58adcd952928e16c7ada57d30a48967c9afb292751.bin\")\n\
      \ Found reference to API \"MoveFileExA\" (Indicator: \"MoveFile\"; File: \"\
      1507f04928c290940a797b58adcd952928e16c7ada57d30a48967c9afb292751.bin\")\n Found\
      \ reference to API \"MoveFileA\" (Indicator: \"MoveFile\"; Source: \"00000000-00007960.00000000.195556.004A5000.00000040.mdmp\"\
      )\n Found reference to API \"MoveFileExA\" (Indicator: \"MoveFile\"; Source:\
      \ \"00000000-00007960.00000000.195556.004A5000.00000040.mdmp\")"
  - EventData: Contains ability to move file or directory (API string)
  - EventData: string-322
  selection_network:
  - DestinationHostname: 1507f04928c290940a797b58adcd952928e16c7ada57d30a48967c9afb292751.bin
  - DestinationHostname: 1507f04928c290940a797b58adcd952928e16c7ada57d30a48967c9afb292751.bin.exe
  - DestinationHostname: ADVAPI32.dll
  - DestinationHostname: Gdi32.dll
  - DestinationHostname: Mpr.dll
  - DestinationHostname: Shell32.dll
  - DestinationHostname: User32.dll
  - DestinationHostname: advapi32.dll
  - DestinationHostname: api-ms-win-core-synch-l1-2-0.dll
  - DestinationHostname: d64.sys
  - DestinationHostname: iphlpapi.dll
  - DestinationHostname: kernel32.dll
  - DestinationHostname: modem.sys
  - DestinationHostname: modem64.sys
  - DestinationHostname: ntdll.dll
  - DestinationHostname: out.prn
  - DestinationHostname: user32.dll
  - DestinationIp: 106.52.51.128
  condition: selection_behavior or selection_network
