title: malware behavior detection (e2cc09c1)
id: e2cc09c158c15d0fa6597cd322f48b3ff0f6c49424f96bd985298bdcdc735fea
status: experimental
description: Auto-generated Sigma rule for malware
logsource:
  product: windows
  service: sysmon
detection:
  selection_behavior:
  - EventData: "The input sample is signed with a certificate issued by \"CN=Amazon\
      \ RSA 2048 M04, O=Amazon, C=US\" (SHA1: 58:14:B9:EC:31:28:BD:EA:CD:4A:1A:3A:FC:32:DF:97:07:83:31:EA;\
      \ see report for more information)\n The input sample is signed with a certificate\
      \ issued by \"CN=Amazon Root CA 1, O=Amazon, C=US\" (SHA1: E7:B8:B5:A6:74:3C:E1:B2:F1:7B:04:1D:E5:95:58:A4:14:72:D7:0C;\
      \ see report for more information)\n The input sample is signed with a certificate\
      \ issued by \"CN=Starfield Services Root Certificate Authority - G2, O=\"Starfield\
      \ Technologies\n Inc.\", L=Scottsdale, ST=Arizona, C=US\" (SHA1: 06:B2:59:27:C4:2A:72:16:31:C1:EF:D9:43:1E:64:8F:A6:2E:1E:39;\
      \ see report for more information)\n The input sample is signed with a certificate\
      \ issued by \"CN=WE1, O=Google Trust Services, C=US\" (SHA1: 6D:85:B9:EC:DA:D0:86:4E:C5:AF:4B:45:97:FD:2C:A1:62:E8:B2:73;\
      \ see report for more information)\n The input sample is signed with a certificate\
      \ issued by \"CN=GTS Root R4, O=Google Trust Services LLC, C=US\" (SHA1: 10:8F:BF:79:4E:18:EC:53:47:A4:14:E4:37:0C:C4:50:6C:29:7A:B2;\
      \ see report for more information)\n The input sample is signed with a certificate\
      \ issued by \"CN=GlobalSign Root CA, OU=Root CA, O=GlobalSign nv-sa, C=BE\"\
      \ (SHA1: 93:2B:ED:33:9A:A6:92:12:C8:93:75:B7:93:04:B4:75:49:0B:89:A0; see report\
      \ for more information)\n The input sample is signed with a certificate issued\
      \ by \"CN=WE1, O=Google Trust Services, C=US\" (SHA1: C6:6A:71:84:C2:40:13:D1:A4:B7:DF:C4:1C:E1:54:F3:76:97:EF:6B;\
      \ see report for more information)\n The input sample is signed with a certificate\
      \ issued by \"CN=WE1, O=Google Trust Services, C=US\" (SHA1: 96:D0:B4:5A:E7:D8:9A:25:C5:9F:54:D1:01:21:F4:66:DF:6E:71:C1;\
      \ see report for more information)"
  - EventData: The input sample is signed with a certificate
  - EventData: certificate-0
  - EventData: "Spawned process \"msedge.exe\" with commandline \"--single-argument\
      \ https://refund.portal-tron.com/\" (UID: 00000000-00007940)\n Spawned process\
      \ \"msedge.exe\" with commandline \"--type=crashpad-handler \"--user-data-dir=%LOCALAPPDATA%\\\
      \\Microso ...\" (UID: 00000000-00006868), Spawned process \"msedge.exe\" with\
      \ commandline \"--type=gpu-process --gpu-preferences=UAAAAAAAAADgAAAYAAAAAAAAAAA\
      \ ...\" (UID: 00000000-00007896), Spawned process \"msedge.exe\" with commandline\
      \ \"--type=utility --utility-sub-type=network.mojom.NetworkService - ...\" (UID:\
      \ 00000000-00005972), Spawned process \"msedge.exe\" with commandline \"--type=utility\
      \ --utility-sub-type=storage.mojom.StorageService - ...\" (UID: 00000000-00007408),\
      \ Spawned process \"msedge.exe\" with commandline \"--type=renderer --display-capture-permissions-policy-allowed\
      \ --j ...\" (UID: 00000000-00004316), Spawned process \"msedge.exe\" with commandline\
      \ \"--type=renderer --display-capture-permissions-policy-allowed --j ...\" (UID:\
      \ 00000000-00004364), Spawned process \"msedge.exe\" with commandline \"--type=utility\
      \ --utility-sub-type=asset_store.mojom.AssetStoreSe ...\" (UID: 00000000-00002848),\
      \ Spawned process \"msedge.exe\" with commandline \"--type=utility --utility-sub-type=data_decoder.mojom.DataDecoder\
      \ ...\" (UID: 00000000-00007468), Spawned process \"msedge.exe\" with commandline\
      \ \"--type=utility --utility-sub-type=data_decoder.mojom.DataDecoder ...\" (UID:\
      \ 00000000-00004504), Spawned process \"msedge.exe\" with commandline \"--type=utility\
      \ --utility-sub-type=data_decoder.mojom.DataDecoder ...\" (UID: 00000000-00005724),\
      \ Spawned process \"msedge.exe\" with commandline \"--type=utility --utility-sub-type=data_decoder.mojom.DataDecoder\
      \ ...\" (UID: 00000000-00007792), Spawned process \"msedge.exe\" with commandline\
      \ \"--type=utility --utility-sub-type=unzip.mojom.Unzipper --lang=en ...\" (UID:\
      \ 00000000-00002440), Spawned process \"msedge.exe\" with commandline \"--type=utility\
      \ --utility-sub-type=unzip.mojom.Unzipper --lang=en ...\" (UID: 00000000-00007368),\
      \ Spawned process \"msedge.exe\" with commandline \"--type=utility --utility-sub-type=unzip.mojom.Unzipper\
      \ --lang=en ...\" (UID: 00000000-00007328), Spawned process \"msedge.exe\" with\
      \ commandline \"--type=utility --utility-sub-type=unzip.mojom.Unzipper --lang=en\
      \ ...\" (UID: 00000000-00007924), Spawned process \"msedge.exe\" with commandline\
      \ \"--type=gpu-process --disable-gpu-sandbox --use-gl=disabled --gpu ...\" (UID:\
      \ 00000000-00003376), Spawned process \"msedge.exe\" with commandline \"--type=utility\
      \ --utility-sub-type=unzip.mojom.Unzipper --lang=en ...\" (UID: 00000000-00006140),\
      \ Spawned process \"msedge.exe\" with commandline \"--type=utility --utility-sub-type=unzip.mojom.Unzipper\
      \ --lang=en ...\" (UID: 00000000-00003352), Spawned process \"msedge.exe\" with\
      \ commandline \"--type=utility --utility-sub-type=unzip.mojom.Unzipper --lang=en\
      \ ...\" (UID: 00000000-00006768), Spawned process \"msedge.exe\" with commandline\
      \ \"--type=utility --utility-sub-type=unzip.mojom.Unzipper --lang=en ...\" (UID:\
      \ 00000000-00001108), Spawned process \"msedge.exe\" with commandline \"--type=utility\
      \ --utility-sub-type=unzip.mojom.Unzipper --lang=en ...\" (UID: 00000000-00007884)"
  - EventData: Spawns new processes that are not known child processes
  - EventData: target-103
  - EventData: "Process \"msedge.exe\" (UID: 00000000-00007940) was launched with\
      \ new environment variables: \"USERDNSDOMAIN=\"DESKTOP-FVVF82A\"\"\n Process\
      \ \"msedge.exe\" (UID: 00000000-00007940) was launched with modified environment\
      \ variables: \"PROCESSOR_ARCHITECTURE, CommonProgramFiles, Path, ProgramFiles,\
      \ NUMBER_OF_PROCESSORS\"\n Process \"msedge.exe\" (UID: 00000000-00007940) was\
      \ launched with missing environment variables: \"PROCESSOR_ARCHITEW6432\"\n\
      \ Process \"msedge.exe\" (UID: 00000000-00006868) was launched with new environment\
      \ variables: \"CHROME_CRASHPAD_PIPE_NAME=\"\\\\.\\pipe\\LOCAL\\crashpad_7940_IICUWYTUDUSRDPAX\"\
      , EDGE_BROWSER_PID=\"7940\"\"\n Process \"msedge.exe\" (UID: 00000000-00007896)\
      \ was launched with new environment variables: \"EDGE_METRICS_SESSION_ID=\"\
      29\", EDGE_USER_DATA_DIR=\"%LOCALAPPDATA%\\Microsoft\\Edge\\User Data\", EDGE_VARIATIONS_SEED_ETAG=\"\
      \"uiIxlFHEqYK/kbVuiEU5CgZajeU9QmL4/F97KjHfTZw=\"\", EDGE_METRICS_CLIENT_ID_HASH=\"\
      -5815550854748070847\"\"\n Process \"msedge.exe\" (UID: 00000000-00005972) was\
      \ launched with new environment variables: \"CHROME_RESTART=\"Microsoft Edge|Microsoft\
      \ Edge has stopped working. Restart it?|LEFT_TO_RIGHT\"\""
  - EventData: Process launched with changed environment
  - EventData: target-67
  - EventData: Spawns new processes
  - EventData: target-25
  - EventData: "\"104.21.92.57:443\"\n \"104.16.79.73:443\"\n \"3.214.98.111:443\"\
      \n \"104.21.21.226:443\""
  - EventData: Contacts server
  - EventData: network-1
  - EventData: "\"bsc-dataseed.binance.org\"\n \"refund.portal-tron.com\"\n \"static.cloudflareinsights.com\"\
      \n \"trontokenapi.com\""
  - EventData: Queries DNS server
  - EventData: network-51
  - EventData: '"urlref_httpsrefund.portal-tron.com" has type "HTML document ASCII
      text with very long lines (63797) with CRLF line terminators"- [targetUID: N/A]'
  - EventData: Dropped files
  - EventData: binary-0
  - EventData: "Heuristic match: \"hitpsy/refund.portal-tron.com\"\n Heuristic match:\
      \ \"https;//refund.portal-tron.com\"\n Pattern match: \"https://refund.portal-tron.com/\"\
      \n Pattern match: \"https://refund.portal-tron.com\"\n Heuristic match: \"bsc-dataseed.binance.org\"\
      \n Heuristic match: \"refund.portal-tron.com\"\n Heuristic match: \"static.cloudflareinsights.com\"\
      \n Heuristic match: \"trontokenapi.com\""
  - EventData: Found potential URL in binary/memory
  - EventData: string-3
  - EventData: "Short term registered certificate: \"refund.portal-tron.com\" (90\
      \ days old)\n Short term registered certificate: \"static.cloudflareinsights.com\"\
      \ (90 days old)\n Short term registered certificate: \"trontokenapi.com\" (90\
      \ days old)"
  - EventData: Short-term SSL certificate detected
  - EventData: certificate-3
  - EventData: 'Newly renewed or created SSL certificate: "refund.portal-tron.com"
      (0 days old)'
  - EventData: Recently renewed or created SSL certificate
  - EventData: certificate-4
  - EventData: "Contacted domain: \"bsc-dataseed.binance.org\" has high entropy\n\
      \ Contacted domain: \"refund.portal-tron.com\" has high entropy\n Contacted\
      \ domain: \"static.cloudflareinsights.com\" has high entropy"
  - EventData: High entropy domain detected
  - EventData: network-81
  - EventData: 'Detected alert "ET INFO Observed Smart Chain Domain in TLS SNI (bsc-dataseed
      .binance .org)" (SID: 2058779, Rev: 1, Severity: 3) categorized as "Misc activity"'
  - EventData: Detected Suricata Alert
  - EventData: suricata-0
  - EventData: 'Recently Registered domain detected: "portal-tron.com" (0 days old).
      Commonly seen with phishing or other suspicious domains'
  - EventData: Recently registered domain detected
  - EventData: network-8601
  - EventData: 'CONTACTED DOMAIN: "trontokenapi.com" has been identified as malicious'
  - EventData: Malicious domain detected
  - EventData: network-85
  selection_network:
  - DestinationHostname: bsc-dataseed.binance.org
  - DestinationHostname: k.eA
  - DestinationHostname: refund.portal-tron.com
  - DestinationHostname: static.cloudflareinsights.com
  - DestinationHostname: trontokenapi.com
  - DestinationIp: 104.16.79.73
  - DestinationIp: 104.21.21.226
  - DestinationIp: 104.21.92.57
  - DestinationIp: 3.214.98.111
  condition: selection_behavior or selection_network
