title: Malware_50.5 behavior detection (618d80a3)
id: 618d80a33f64fca832ff22405917d8e1eae991eda4f21e572d1f0382970a32a7
status: experimental
description: Auto-generated Sigma rule for Malware_50.5
logsource:
  product: windows
  service: sysmon
detection:
  selection_behavior:
  - EventData: "Found reference to API \"RegCloseKey\" (Indicator: \"RegCloseKey\"\
      ; File: \"618d80a33f64fca832ff22405917d8e1eae991eda4f21e572d1f0382970a32a7.bin\"\
      )\n Found reference to API \"RegCloseKey\" (Indicator: \"RegCloseKey\"; Source:\
      \ \"00000000-00005476.00000000.206721.401E6000.00000002.mdmp\")"
  - EventData: Contains ability to disable/close registry key (API string)
  - EventData: string-345
  - EventData: "Found reference to API \"CreateFileA\" (Indicator: \"CreateFile\"\
      ; File: \"618d80a33f64fca832ff22405917d8e1eae991eda4f21e572d1f0382970a32a7.bin\"\
      )\n Found reference to API \"CreateFileW\" (Indicator: \"CreateFile\"; File:\
      \ \"618d80a33f64fca832ff22405917d8e1eae991eda4f21e572d1f0382970a32a7.bin\")\n\
      \ Found reference to API \"CreateFileTransactedA\" (Indicator: \"CreateFile\"\
      ; File: \"618d80a33f64fca832ff22405917d8e1eae991eda4f21e572d1f0382970a32a7.bin\"\
      )\n Found reference to API \"CreateFileTransactedA\" (Indicator: \"CreateFile\"\
      ; Source: \"00000000-00005476.00000000.206721.401E6000.00000002.mdmp\")\n Found\
      \ reference to API \"CreateFileA\" (Indicator: \"CreateFile\"; Source: \"00000000-00005476.00000000.206721.401E6000.00000002.mdmp\"\
      )\n Found reference to API \"CreateFileW\" (Indicator: \"CreateFile\"; Source:\
      \ \"00000000-00005476.00000000.206721.401E6000.00000002.mdmp\")"
  - EventData: Contains ability to create/open files (API string)
  - EventData: string-315
  - EventData: "Found reference to API \"ShellExecuteA\" (Indicator: \"ShellExecute\"\
      ; File: \"618d80a33f64fca832ff22405917d8e1eae991eda4f21e572d1f0382970a32a7.bin\"\
      )\n Found reference to API \"ShellExecuteA\" (Indicator: \"ShellExecute\"; Source:\
      \ \"00000000-00005476.00000000.206721.401E6000.00000002.mdmp\")"
  - EventData: Contains ability to execute an application (API string)
  - EventData: string-240
  - EventData: "Found reference to API \"GrayStringA\" (Indicator: \"GrayStringA\"\
      ; File: \"618d80a33f64fca832ff22405917d8e1eae991eda4f21e572d1f0382970a32a7.bin\"\
      )\n Found reference to API \"GrayStringA\" (Indicator: \"GrayStringA\"; Source:\
      \ \"00000000-00005476.00000000.206721.401E6000.00000002.mdmp\")"
  - EventData: Able to use GrayString API for text rendering
  - EventData: string-900
  - EventData: "\"Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\"\
      \ in Source: 618d80a33f64fca832ff22405917d8e1eae991eda4f21e572d1f0382970a32a7.bin\n\
      \ \"Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Network\" in Source:\
      \ 618d80a33f64fca832ff22405917d8e1eae991eda4f21e572d1f0382970a32a7.bin\n \"\
      Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Comdlg32\" in Source:\
      \ 618d80a33f64fca832ff22405917d8e1eae991eda4f21e572d1f0382970a32a7.bin\n \"\
      Software\\Classes\\\" in Source: 618d80a33f64fca832ff22405917d8e1eae991eda4f21e572d1f0382970a32a7.bin\n\
      \ \"Software\\\" in Source: 618d80a33f64fca832ff22405917d8e1eae991eda4f21e572d1f0382970a32a7.bin\n\
      \ \"SOFTWARE\\\" in Source: 618d80a33f64fca832ff22405917d8e1eae991eda4f21e572d1f0382970a32a7.bin\n\
      \ \"Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\" in Source:\
      \ 00000000-00005476.00000000.206721.401E6000.00000002.mdmp\n \"Software\\Microsoft\\\
      Windows\\CurrentVersion\\Policies\\Network\" in Source: 00000000-00005476.00000000.206721.401E6000.00000002.mdmp\n\
      \ \"Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Comdlg32\" in Source:\
      \ 00000000-00005476.00000000.206721.401E6000.00000002.mdmp\n \"Software\\Classes\\\
      \" in Source: 00000000-00005476.00000000.206721.401E6000.00000002.mdmp\n \"\
      Software\\\" in Source: 00000000-00005476.00000000.206721.401E6000.00000002.mdmp\n\
      \ \"SOFTWARE\\\" in Source: 00000000-00005476.00000000.206721.401E6000.00000002.mdmp"
  - EventData: Contains registry location strings
  - EventData: string-120
  - EventData: "Found string \"Copyright (c) 1992-2004 by P.J. Plauger, licensed by\
      \ Dinkumware, Ltd. ALL RIGHTS RESERVED.\" (Indicator: \"Copyright (c) 1992-2004\
      \ by P.J. Plauger\n licensed by Dinkumware\n Ltd. ALL RIGHTS RESERVED.\"; File:\
      \ \"618d80a33f64fca832ff22405917d8e1eae991eda4f21e572d1f0382970a32a7.bin\")"
  - EventData: Contains reference to licensed c/c++ library
  - EventData: string-462
  - EventData: 'Found string "GetCommandLineA" (Source: "00000000-00005476.00000000.206721.401E6000.00000002.mdmp")'
  - EventData: Able to retrieve command line parameters of the running process
  - EventData: string-930
  - EventData: "\"<Input Sample.exe\" loaded module \"%WINDIR%\\System32\\bcryptprimitives.dll\"\
      \ at 132A0000\n \"<Input Sample.exe\" loaded module \"%WINDIR%\\System32\\bcrypt.dll\"\
      \ at 11FD0000"
  - EventData: Loads the Bcrypt module DLL
  - EventData: module-9
  - EventData: '"618d80a33f64fca832ff22405917d8e1eae991eda4f21e572d1f0382970a32a7.bin"
      has high imagebase  "0x140000000"'
  - EventData: PE file has a high image base
  - EventData: static-93
  - EventData: details too long to display
  - EventData: Contains ability to execute Windows APIs
  - EventData: string-101
  - EventData: "\"618d80a33f64fca832ff22405917d8e1eae991eda4f21e572d1f0382970a32a7.bin\"\
      \ file has an entrypoint instructions - \"sub\trsp, 0x28,call\t0x1401a0988,add\t\
      rsp, 0x28,jmp\t0x1401911f8,int3\t,int3\t,sub\trsp, 0x38,and\tqword ptr [rsp\
      \ + 0x20], 0,call\t0x1401a0a3c,add\trsp, 0x38,ret\t,mov\trax, rcx,movzx\tedx,\
      \ word ptr [rax],add\trax, 2,test\tdx, dx,jne\t0x1401913bf,sub\trax, rcx,sar\t\
      rax, 1,dec\trax,ret\t,int3\t,int3\t,int3\t,push\trdi,sub\trsp, 0x20,mov\tr10,\
      \ r8,xor\tr8d, r8d,test\tr9, r9,jne\t0x1401913ed,xor\teax, eax,jmp\t0x14019144c,test\t\
      rcx, rcx,jne\t0x140191407,call\t0x140191808,\""
  - EventData: PE file entrypoint instructions
  - EventData: static-96
  - EventData: "Found registry modification API: \"RegCreateKeyExA\" in file \"618d80a33f64fca832ff22405917d8e1eae991eda4f21e572d1f0382970a32a7.bin\"\
      \n Found registry modification API: \"RegCreateKeyTransactedA\" in file \"618d80a33f64fca832ff22405917d8e1eae991eda4f21e572d1f0382970a32a7.bin\"\
      \n Found registry modification API: \"RegCreateKeyTransactedA\" in \"00000000-00005476.00000000.206721.401E6000.00000002.mdmp\"\
      \n Found registry modification API: \"RegCreateKeyExA\" in \"00000000-00005476.00000000.206721.401E6000.00000002.mdmp\""
  - EventData: Able to create/load registry keys (API string)
  - EventData: string-307
  - EventData: "Found reference to API \"FindResourceA\" (Indicator: \"FindResource\"\
      ; File: \"618d80a33f64fca832ff22405917d8e1eae991eda4f21e572d1f0382970a32a7.bin\"\
      )\n Found reference to API \"LockResource\" (Indicator: \"LockResource\"; File:\
      \ \"618d80a33f64fca832ff22405917d8e1eae991eda4f21e572d1f0382970a32a7.bin\")\n\
      \ Found reference to API \"FindResourceExW\" (Indicator: \"FindResource\"; File:\
      \ \"618d80a33f64fca832ff22405917d8e1eae991eda4f21e572d1f0382970a32a7.bin\")\n\
      \ Found reference to API \"FindResourceW\" (Indicator: \"FindResource\"; File:\
      \ \"618d80a33f64fca832ff22405917d8e1eae991eda4f21e572d1f0382970a32a7.bin\")\n\
      \ Found reference to API \"FreeResource\" (Indicator: \"FreeResource\"; File:\
      \ \"618d80a33f64fca832ff22405917d8e1eae991eda4f21e572d1f0382970a32a7.bin\")\n\
      \ Found reference to API \"SizeofResource\" (Indicator: \"SizeofResource\";\
      \ File: \"618d80a33f64fca832ff22405917d8e1eae991eda4f21e572d1f0382970a32a7.bin\"\
      )\n Found reference to API \"LoadResource\" (Indicator: \"LoadResource\"; File:\
      \ \"618d80a33f64fca832ff22405917d8e1eae991eda4f21e572d1f0382970a32a7.bin\")\n\
      \ Found reference to API \"SizeofResource\" (Indicator: \"SizeofResource\";\
      \ Source: \"00000000-00005476.00000000.206721.401E6000.00000002.mdmp\")\n Found\
      \ reference to API \"LockResource\" (Indicator: \"LockResource\"; Source: \"\
      00000000-00005476.00000000.206721.401E6000.00000002.mdmp\")\n Found reference\
      \ to API \"LoadResource\" (Indicator: \"LoadResource\"; Source: \"00000000-00005476.00000000.206721.401E6000.00000002.mdmp\"\
      )\n Found reference to API \"FindResourceW\" (Indicator: \"FindResource\"; Source:\
      \ \"00000000-00005476.00000000.206721.401E6000.00000002.mdmp\")\n Found reference\
      \ to API \"FreeResource\" (Indicator: \"FreeResource\"; Source: \"00000000-00005476.00000000.206721.401E6000.00000002.mdmp\"\
      )\n Found reference to API \"FindResourceA\" (Indicator: \"FindResource\"; Source:\
      \ \"00000000-00005476.00000000.206721.401E6000.00000002.mdmp\")\n Found reference\
      \ to API \"FindResourceExW\" (Indicator: \"FindResource\"; Source: \"00000000-00005476.00000000.206721.401E6000.00000002.mdmp\"\
      )"
  - EventData: Contains ability to find and load resources of specific modules (API
      string)
  - EventData: string-550
  - EventData: "Found reference to API \"CreateThread\" (Indicator: \"CreateThread\"\
      ; File: \"618d80a33f64fca832ff22405917d8e1eae991eda4f21e572d1f0382970a32a7.bin\"\
      )\n Found reference to API \"ResumeThread\" (Indicator: \"ResumeThread\"; File:\
      \ \"618d80a33f64fca832ff22405917d8e1eae991eda4f21e572d1f0382970a32a7.bin\")\n\
      \ Found reference to API \"ResumeThread\" (Indicator: \"ResumeThread\"; Source:\
      \ \"00000000-00005476.00000000.206721.401E6000.00000002.mdmp\")\n Found reference\
      \ to API \"CreateThread\" (Indicator: \"CreateThread\"; Source: \"00000000-00005476.00000000.206721.401E6000.00000002.mdmp\"\
      )"
  - EventData: Contains ability to retrieve/modify process thread (API string)
  - EventData: string-161
  - EventData: "Found reference to API \"GetCommandLineA\" (Indicator: \"GetCommandLine\"\
      ; File: \"618d80a33f64fca832ff22405917d8e1eae991eda4f21e572d1f0382970a32a7.bin\"\
      )\n Found reference to API \"GetCommandLineA\" (Indicator: \"GetCommandLine\"\
      ; Source: \"00000000-00005476.00000000.206721.401E6000.00000002.mdmp\")"
  - EventData: Contains ability to retrieve the command-line string for the current
      process (API string)
  - EventData: string-206
  - EventData: "Found reference to API \"GetProcessHeap\" (Indicator: \"GetProcessHeap\"\
      ; File: \"618d80a33f64fca832ff22405917d8e1eae991eda4f21e572d1f0382970a32a7.bin\"\
      )\n Found reference to API \"GetProcessHeap\" (Indicator: \"GetProcessHeap\"\
      ; Source: \"00000000-00005476.00000000.206721.401E6000.00000002.mdmp\")"
  - EventData: Contains ability to retrieve/open a process (API string)
  - EventData: string-272
  - EventData: "Found reference to API \"GetLastError\" (Indicator: \"GetLastError\"\
      ; File: \"618d80a33f64fca832ff22405917d8e1eae991eda4f21e572d1f0382970a32a7.bin\"\
      )\n Found reference to API \"SetLastError\" (Indicator: \"SetLastError\"; File:\
      \ \"618d80a33f64fca832ff22405917d8e1eae991eda4f21e572d1f0382970a32a7.bin\")\n\
      \ Found reference to API \"SetLastError\" (Indicator: \"SetLastError\"; Source:\
      \ \"00000000-00005476.00000000.206721.401E6000.00000002.mdmp\")\n Found reference\
      \ to API \"GetLastError\" (Indicator: \"GetLastError\"; Source: \"00000000-00005476.00000000.206721.401E6000.00000002.mdmp\"\
      )"
  - EventData: Contains ability to set/get the last-error code for a calling thread
      (API string)
  - EventData: string-319
  - EventData: "Found reference to API \"ShowWindow\" (Indicator: \"ShowWindow\";\
      \ File: \"618d80a33f64fca832ff22405917d8e1eae991eda4f21e572d1f0382970a32a7.bin\"\
      )\n Found reference to API \"GetWindowThreadProcessId\" (Indicator: \"GetWindowThreadProcessId\"\
      ; File: \"618d80a33f64fca832ff22405917d8e1eae991eda4f21e572d1f0382970a32a7.bin\"\
      )\n Found reference to API \"ShowWindow\" (Indicator: \"ShowWindow\"; Source:\
      \ \"00000000-00005476.00000000.206721.401E6000.00000002.mdmp\")\n Found reference\
      \ to API \"GetWindowThreadProcessId\" (Indicator: \"GetWindowThreadProcessId\"\
      ; Source: \"00000000-00005476.00000000.206721.401E6000.00000002.mdmp\")"
  - EventData: Contains ability to show a graphical window (API string)
  - EventData: string-208
  - EventData: "\"Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\"\
      \ in Source: 00000000-00005476.00000000.206721.401E6000.00000002.mdmp\n \"Software\\\
      Microsoft\\Windows\\CurrentVersion\\Policies\\Network\" in Source: 00000000-00005476.00000000.206721.401E6000.00000002.mdmp\n\
      \ \"Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\Comdlg32\" in Source:\
      \ 00000000-00005476.00000000.206721.401E6000.00000002.mdmp\n \"Software\\Classes\\\
      \" in Source: 00000000-00005476.00000000.206721.401E6000.00000002.mdmp\n \"\
      Software\\\" in Source: 00000000-00005476.00000000.206721.401E6000.00000002.mdmp\n\
      \ \"SOFTWARE\\\" in Source: 00000000-00005476.00000000.206721.401E6000.00000002.mdmp"
  - EventData: Found registry location strings in memory
  - EventData: memorydump-10
  - EventData: "\"<Input Sample.exe\" loaded module \"API-MS-WIN-CORE-SYNCH-L1-2-0\"\
      \ at base 7ffb128e0000\n \"<Input Sample.exe\" loaded module \"API-MS-WIN-CORE-FIBERS-L1-1-1\"\
      \ at base 7ffb128e0000\n \"<Input Sample.exe\" loaded module \"API-MS-WIN-CORE-LOCALIZATION-L1-2-1\"\
      \ at base 7ffb128e0000\n \"<Input Sample.exe\" loaded module \"KERNEL32\" at\
      \ base 7ffb14f70000\n \"<Input Sample.exe\" loaded module \"%WINDIR%\\TEMP\\\
      VXOLE64.DLL\" at base 7ffaf3ef0000\n \"<Input Sample.exe\" loaded module \"\
      USER32.DLL\" at base 7ffb15270000\n \"<Input Sample.exe\" loaded module \"%WINDIR%\\\
      SYSTEM32\\UXTHEME.DLL\" at base 7ffb10ab0000\n \"<Input Sample.exe\" loaded\
      \ module \"UXTHEME.DLL\" at base 7ffb10ab0000\n \"<Input Sample.exe\" loaded\
      \ module \"DWMAPI.DLL\" at base 7ffb10d20000\n \"<Input Sample.exe\" loaded\
      \ module \"COMCTL32.DLL\" at base 7ffb01de0000\n \"<Input Sample.exe\" loaded\
      \ module \"KERNEL32.DLL\" at base 7ffb14f70000"
  - EventData: Loads modules at runtime
  - EventData: api-7
  selection_network:
  - DestinationHostname: 618d80a33f64fca832ff22405917d8e1eae991eda4f21e572d1f0382970a32a7.bin
  - DestinationHostname: 618d80a33f64fca832ff22405917d8e1eae991eda4f21e572d1f0382970a32a7.bin.exe
  - DestinationHostname: USER32.dll
  - DestinationHostname: UxTheme.dll
  - DestinationHostname: api-ms-win-core-synch-l1-2-0.dll
  - DestinationHostname: comctl32.dll
  - DestinationHostname: dwmapi.dll
  - DestinationHostname: kernel32.dll
  - DestinationHostname: mscoree.dll
  - DestinationHostname: ntdll.dll
  condition: selection_behavior or selection_network
